{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/copy-category-image/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { promises as fs } from \"fs\";\nimport path from \"path\";\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { sourceImage, newCategoryId, newCategoryName } = await request.json();\n\n    if (!sourceImage || !newCategoryId) {\n      return NextResponse.json({ error: \"Missing parameters\" }, { status: 400 });\n    }\n\n    // Extract filename from source path\n    const sourceFileName = sourceImage.split('/').pop();\n    if (!sourceFileName) {\n      return NextResponse.json({ error: \"Invalid source image path\" }, { status: 400 });\n    }\n\n    // Generate new filename\n    const timestamp = Date.now();\n    const fileExt = sourceFileName.split('.').pop() || 'png';\n    const sanitizedName = (newCategoryName || 'category')\n      .toLowerCase()\n      .replace(/[^a-z0-9]/g, '-')\n      .replace(/-+/g, '-')\n      .replace(/^-|-$/g, '');\n    \n    const newFileName = `${sanitizedName}-${newCategoryId}-${timestamp}.${fileExt}`;\n    \n    // Define paths\n    const publicDir = path.join(process.cwd(), \"public\");\n    const sourceFullPath = path.join(publicDir, sourceImage);\n    const destDir = path.join(publicDir, \"fotos\", \"categorias\");\n    const destFullPath = path.join(destDir, newFileName);\n    \n    // Check if source file exists\n    try {\n      await fs.access(sourceFullPath);\n    } catch {\n      // Source file doesn't exist, return original path\n      return NextResponse.json({ imagePath: sourceImage });\n    }\n    \n    // Copy the file\n    await fs.copyFile(sourceFullPath, destFullPath);\n    \n    // Return new image path\n    const newImagePath = `/fotos/categorias/${newFileName}`;\n    \n    return NextResponse.json({ imagePath: newImagePath });\n  } catch (error) {\n    console.error(\"Error copying image:\", error);\n    return NextResponse.json({ error: \"Failed to copy image\" }, { status: 500 });\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,WAAW,EAAE,aAAa,EAAE,eAAe,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE1E,IAAI,CAAC,eAAe,CAAC,eAAe;YAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QAC1E;QAEA,oCAAoC;QACpC,MAAM,iBAAiB,YAAY,KAAK,CAAC,KAAK,GAAG;QACjD,IAAI,CAAC,gBAAgB;YACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QACjF;QAEA,wBAAwB;QACxB,MAAM,YAAY,KAAK,GAAG;QAC1B,MAAM,UAAU,eAAe,KAAK,CAAC,KAAK,GAAG,MAAM;QACnD,MAAM,gBAAgB,CAAC,mBAAmB,UAAU,EACjD,WAAW,GACX,OAAO,CAAC,cAAc,KACtB,OAAO,CAAC,OAAO,KACf,OAAO,CAAC,UAAU;QAErB,MAAM,cAAc,GAAG,cAAc,CAAC,EAAE,cAAc,CAAC,EAAE,UAAU,CAAC,EAAE,SAAS;QAE/E,eAAe;QACf,MAAM,YAAY,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;QAC3C,MAAM,iBAAiB,4GAAI,CAAC,IAAI,CAAC,WAAW;QAC5C,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,WAAW,SAAS;QAC9C,MAAM,eAAe,4GAAI,CAAC,IAAI,CAAC,SAAS;QAExC,8BAA8B;QAC9B,IAAI;YACF,MAAM,yGAAE,CAAC,MAAM,CAAC;QAClB,EAAE,OAAM;YACN,kDAAkD;YAClD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,WAAW;YAAY;QACpD;QAEA,gBAAgB;QAChB,MAAM,yGAAE,CAAC,QAAQ,CAAC,gBAAgB;QAElC,wBAAwB;QACxB,MAAM,eAAe,CAAC,kBAAkB,EAAE,aAAa;QAEvD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,WAAW;QAAa;IACrD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuB,GAAG;YAAE,QAAQ;QAAI;IAC5E;AACF","debugId":null}}]
}