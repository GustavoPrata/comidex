{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/mobile/products/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@supabase/supabase-js'\n\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n)\n\n// GET - Listar produtos com filtros\nexport async function GET(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams\n    const category_id = searchParams.get('category_id')\n    const mode = searchParams.get('mode') // 'rodizio' ou 'carte'\n    \n    let query = supabase\n      .from('products')\n      .select('*, categories(name, icon)')\n      .eq('active', true)\n      .order('name', { ascending: true })\n\n    // Filtrar por categoria se especificado\n    if (category_id && category_id !== '999') {\n      query = query.eq('category_id', parseInt(category_id))\n    }\n    \n    // Se categoria bebidas (999), filtrar por produtos que contenham \"bebida\" ou \"drink\"\n    if (category_id === '999') {\n      query = query.or('name.ilike.%bebida%,name.ilike.%drink%,name.ilike.%suco%,name.ilike.%refrigerante%')\n    }\n\n    const { data: products, error } = await query\n\n    if (error) throw error\n\n    // Filtrar por modo se especificado\n    let filteredProducts = products || []\n    \n    if (mode === 'rodizio') {\n      // Rodízio - apenas produtos com preço 0\n      filteredProducts = filteredProducts.filter(p => parseFloat(p.price) === 0)\n    } else if (mode === 'carte') {\n      // À La Carte - apenas produtos com preço > 0\n      filteredProducts = filteredProducts.filter(p => parseFloat(p.price) > 0)\n    }\n\n    // Formatar resposta\n    const formattedProducts = filteredProducts.map(product => ({\n      id: product.id,\n      name: product.name,\n      description: product.description,\n      price: product.price,\n      image_url: product.image_url,\n      category: product.categories?.name || 'Sem categoria',\n      category_id: product.category_id,\n      is_premium: product.is_premium || false,\n      printer_id: product.printer_id,\n      available: product.active\n    }))\n\n    return NextResponse.json({\n      success: true,\n      products: formattedProducts,\n      total: formattedProducts.length\n    })\n  } catch (error: any) {\n    console.error('Erro ao buscar produtos:', error)\n    return NextResponse.json(\n      { \n        success: false,\n        error: 'Erro ao buscar produtos',\n        message: error.message \n      },\n      { status: 500 }\n    )\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,WAAW,IAAA,yMAAY;AAMtB,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,cAAc,aAAa,GAAG,CAAC;QACrC,MAAM,OAAO,aAAa,GAAG,CAAC,QAAQ,uBAAuB;;QAE7D,IAAI,QAAQ,SACT,IAAI,CAAC,YACL,MAAM,CAAC,6BACP,EAAE,CAAC,UAAU,MACb,KAAK,CAAC,QAAQ;YAAE,WAAW;QAAK;QAEnC,wCAAwC;QACxC,IAAI,eAAe,gBAAgB,OAAO;YACxC,QAAQ,MAAM,EAAE,CAAC,eAAe,SAAS;QAC3C;QAEA,qFAAqF;QACrF,IAAI,gBAAgB,OAAO;YACzB,QAAQ,MAAM,EAAE,CAAC;QACnB;QAEA,MAAM,EAAE,MAAM,QAAQ,EAAE,KAAK,EAAE,GAAG,MAAM;QAExC,IAAI,OAAO,MAAM;QAEjB,mCAAmC;QACnC,IAAI,mBAAmB,YAAY,EAAE;QAErC,IAAI,SAAS,WAAW;YACtB,wCAAwC;YACxC,mBAAmB,iBAAiB,MAAM,CAAC,CAAA,IAAK,WAAW,EAAE,KAAK,MAAM;QAC1E,OAAO,IAAI,SAAS,SAAS;YAC3B,6CAA6C;YAC7C,mBAAmB,iBAAiB,MAAM,CAAC,CAAA,IAAK,WAAW,EAAE,KAAK,IAAI;QACxE;QAEA,oBAAoB;QACpB,MAAM,oBAAoB,iBAAiB,GAAG,CAAC,CAAA,UAAW,CAAC;gBACzD,IAAI,QAAQ,EAAE;gBACd,MAAM,QAAQ,IAAI;gBAClB,aAAa,QAAQ,WAAW;gBAChC,OAAO,QAAQ,KAAK;gBACpB,WAAW,QAAQ,SAAS;gBAC5B,UAAU,QAAQ,UAAU,EAAE,QAAQ;gBACtC,aAAa,QAAQ,WAAW;gBAChC,YAAY,QAAQ,UAAU,IAAI;gBAClC,YAAY,QAAQ,UAAU;gBAC9B,WAAW,QAAQ,MAAM;YAC3B,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,UAAU;YACV,OAAO,kBAAkB,MAAM;QACjC;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO;YACP,SAAS,MAAM,OAAO;QACxB,GACA;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}