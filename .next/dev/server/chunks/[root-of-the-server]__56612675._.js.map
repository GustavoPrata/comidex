{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/db/%5Btable%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { Pool } from 'pg';\n\n// Conex√£o PostgreSQL direta\nconst pool = new Pool({\n  connectionString: 'postgresql://postgres.wlqvqrgjqowervexcosv:ds4ad456sad546as654d@aws-1-us-east-1.pooler.supabase.com:5432/postgres',\n  max: 20,\n  idleTimeoutMillis: 30000,\n  connectionTimeoutMillis: 2000,\n});\n\n// GET - Buscar dados\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ table: string }> }\n) {\n  const { table } = await params;\n  const searchParams = request.nextUrl.searchParams;\n  const columns = searchParams.get('columns') || '*';\n  const limit = searchParams.get('limit');\n  const single = searchParams.get('single') === 'true';\n  const order = searchParams.get('order');\n  \n  try {\n    let query = `SELECT ${columns} FROM ${table}`;\n    const values: any[] = [];\n    let paramCount = 1;\n    \n    // Adicionar filtros WHERE\n    const whereConditions: string[] = [];\n    for (const [key, value] of searchParams.entries()) {\n      if (key !== 'columns' && key !== 'limit' && key !== 'single' && key !== 'order') {\n        if (key.endsWith('_in')) {\n          const column = key.replace('_in', '');\n          const inValues = value.split(',');\n          const placeholders = inValues.map(() => `$${paramCount++}`).join(',');\n          whereConditions.push(`${column} IN (${placeholders})`);\n          values.push(...inValues);\n        } else {\n          whereConditions.push(`${key} = $${paramCount++}`);\n          values.push(value);\n        }\n      }\n    }\n    \n    if (whereConditions.length > 0) {\n      query += ` WHERE ${whereConditions.join(' AND ')}`;\n    }\n    \n    // Adicionar ORDER BY\n    if (order) {\n      const [column, direction] = order.split('.');\n      query += ` ORDER BY ${column} ${direction === 'desc' ? 'DESC' : 'ASC'}`;\n    } else {\n      query += ` ORDER BY id`;\n    }\n    \n    // Adicionar LIMIT\n    if (single) {\n      query += ` LIMIT 1`;\n    } else if (limit) {\n      query += ` LIMIT $${paramCount++}`;\n      values.push(parseInt(limit));\n    }\n    \n    const result = await pool.query(query, values);\n    \n    const data = single ? result.rows[0] || null : result.rows;\n    return NextResponse.json({ data, error: null });\n  } catch (error: any) {\n    console.error(`Error fetching from ${table}:`, error);\n    return NextResponse.json(\n      { data: null, error: { message: error.message } },\n      { status: 500 }\n    );\n  }\n}\n\n// POST - Inserir dados\nexport async function POST(\n  request: NextRequest,\n  { params }: { params: Promise<{ table: string }> }\n) {\n  const { table } = await params;\n  \n  try {\n    const body = await request.json();\n    const items = Array.isArray(body) ? body : [body];\n    const results = [];\n    \n    for (const item of items) {\n      const keys = Object.keys(item);\n      const values = Object.values(item);\n      const placeholders = keys.map((_, i) => `$${i + 1}`).join(', ');\n      \n      const query = `\n        INSERT INTO ${table} (${keys.join(', ')}) \n        VALUES (${placeholders}) \n        RETURNING *\n      `;\n      \n      const result = await pool.query(query, values);\n      results.push(result.rows[0]);\n    }\n    \n    const data = Array.isArray(body) ? results : results[0];\n    return NextResponse.json({ data, error: null });\n  } catch (error: any) {\n    console.error(`Error inserting into ${table}:`, error);\n    return NextResponse.json(\n      { data: null, error: { message: error.message } },\n      { status: 500 }\n    );\n  }\n}\n\n// PUT - Atualizar dados\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ table: string }> }\n) {\n  const { table } = await params;\n  \n  try {\n    const { data, where } = await request.json();\n    \n    const dataKeys = Object.keys(data);\n    const dataValues = Object.values(data);\n    const whereKey = Object.keys(where)[0];\n    const whereValue = where[whereKey];\n    \n    const setClause = dataKeys.map((key, i) => `${key} = $${i + 2}`).join(', ');\n    \n    const query = `\n      UPDATE ${table} \n      SET ${setClause}, updated_at = NOW()\n      WHERE ${whereKey} = $1 \n      RETURNING *\n    `;\n    \n    const result = await pool.query(query, [whereValue, ...dataValues]);\n    return NextResponse.json({ data: result.rows, error: null });\n  } catch (error: any) {\n    console.error(`Error updating ${table}:`, error);\n    return NextResponse.json(\n      { data: null, error: { message: error.message } },\n      { status: 500 }\n    );\n  }\n}\n\n// DELETE - Deletar dados\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ table: string }> }\n) {\n  const { table } = await params;\n  \n  try {\n    const { where } = await request.json();\n    const whereKey = Object.keys(where)[0];\n    const whereValue = where[whereKey];\n    \n    const query = `DELETE FROM ${table} WHERE ${whereKey} = $1 RETURNING *`;\n    const result = await pool.query(query, [whereValue]);\n    \n    return NextResponse.json({ data: result.rows, error: null });\n  } catch (error: any) {\n    console.error(`Error deleting from ${table}:`, error);\n    return NextResponse.json(\n      { data: null, error: { message: error.message } },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":"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","debugId":null}}]
}