{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/admin/menu-structure/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { Pool } from \"pg\";\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.DATABASE_URL?.includes('localhost') ? false : {\n    rejectUnauthorized: false\n  }\n});\n\nexport async function GET(request: NextRequest) {\n  try {\n    // Buscar grupos com suas categorias\n    const groupsQuery = `\n      SELECT \n        g.id,\n        g.name,\n        g.description,\n        g.type,\n        g.price,\n        g.half_price,\n        g.active,\n        g.sort_order,\n        g.icon,\n        g.created_at,\n        g.updated_at\n      FROM groups g\n      ORDER BY g.sort_order, g.id\n    `;\n\n    const categoriesQuery = `\n      SELECT \n        c.id,\n        c.name,\n        c.description,\n        c.image,\n        c.active,\n        c.sort_order,\n        c.group_id,\n        c.created_at,\n        c.updated_at,\n        COUNT(i.id) as item_count\n      FROM categories c\n      LEFT JOIN items i ON i.category_id = c.id\n      GROUP BY c.id\n      ORDER BY c.sort_order, c.id\n    `;\n\n    const [groupsResult, categoriesResult] = await Promise.all([\n      pool.query(groupsQuery),\n      pool.query(categoriesQuery)\n    ]);\n\n    const groups = groupsResult.rows;\n    const categories = categoriesResult.rows;\n\n    // Organizar categorias por grupo\n    const groupsWithCategories = groups.map(group => {\n      const groupCategories = categories\n        .filter(cat => cat.group_id === group.id)\n        .map(cat => ({\n          ...cat,\n          itemCount: parseInt(cat.item_count || 0)\n        }));\n      \n      const itemCount = groupCategories.reduce((sum, cat) => sum + cat.itemCount, 0);\n      \n      return {\n        ...group,\n        categories: groupCategories,\n        itemCount\n      };\n    });\n\n    return NextResponse.json({\n      success: true,\n      groups: groupsWithCategories\n    });\n\n  } catch (error) {\n    console.error('Erro ao carregar estrutura do menu:', error);\n    return NextResponse.json(\n      { success: false, error: 'Erro ao carregar estrutura do menu' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { type, data } = body;\n\n    if (type === 'group') {\n      const { name, description, type: groupType, price, half_price, active, sort_order, icon } = data;\n      \n      const query = `\n        INSERT INTO groups (name, description, type, price, half_price, active, sort_order, icon)\n        VALUES ($1, $2, $3, $4, $5, $6, $7, $8)\n        RETURNING *\n      `;\n      \n      const result = await pool.query(query, [\n        name,\n        description || null,\n        groupType || 'a_la_carte',\n        price || null,\n        half_price || null,\n        active !== false,\n        sort_order || 0,\n        icon || null\n      ]);\n\n      return NextResponse.json({\n        success: true,\n        group: result.rows[0]\n      });\n    }\n\n    if (type === 'category') {\n      const { name, description, image, group_id, active, sort_order } = data;\n      \n      const query = `\n        INSERT INTO categories (name, description, image, group_id, active, sort_order)\n        VALUES ($1, $2, $3, $4, $5, $6)\n        RETURNING *\n      `;\n      \n      const result = await pool.query(query, [\n        name,\n        description || null,\n        image || null,\n        group_id,\n        active !== false,\n        sort_order || 0\n      ]);\n\n      return NextResponse.json({\n        success: true,\n        category: result.rows[0]\n      });\n    }\n\n    return NextResponse.json(\n      { success: false, error: 'Tipo inv치lido' },\n      { status: 400 }\n    );\n\n  } catch (error) {\n    console.error('Erro ao criar item:', error);\n    return NextResponse.json(\n      { success: false, error: 'Erro ao criar item' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function PUT(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { type, id, data } = body;\n\n    if (type === 'group') {\n      const { name, description, type: groupType, price, half_price, active, sort_order, icon } = data;\n      \n      const query = `\n        UPDATE groups \n        SET name = $2, description = $3, type = $4, price = $5, half_price = $6, \n            active = $7, sort_order = $8, icon = $9, updated_at = NOW()\n        WHERE id = $1\n        RETURNING *\n      `;\n      \n      const result = await pool.query(query, [\n        id,\n        name,\n        description || null,\n        groupType || 'a_la_carte',\n        price || null,\n        half_price || null,\n        active !== false,\n        sort_order || 0,\n        icon || null\n      ]);\n\n      return NextResponse.json({\n        success: true,\n        group: result.rows[0]\n      });\n    }\n\n    if (type === 'category') {\n      const { name, description, image, group_id, active, sort_order } = data;\n      \n      const query = `\n        UPDATE categories \n        SET name = $2, description = $3, image = $4, group_id = $5, \n            active = $6, sort_order = $7, updated_at = NOW()\n        WHERE id = $1\n        RETURNING *\n      `;\n      \n      const result = await pool.query(query, [\n        id,\n        name,\n        description || null,\n        image || null,\n        group_id,\n        active !== false,\n        sort_order || 0\n      ]);\n\n      return NextResponse.json({\n        success: true,\n        category: result.rows[0]\n      });\n    }\n\n    if (type === 'reorder') {\n      const { items, itemType } = data;\n      const table = itemType === 'group' ? 'groups' : 'categories';\n      \n      // Atualizar sort_order para cada item\n      for (let i = 0; i < items.length; i++) {\n        await pool.query(\n          `UPDATE ${table} SET sort_order = $2 WHERE id = $1`,\n          [items[i].id, i]\n        );\n      }\n\n      return NextResponse.json({ success: true });\n    }\n\n    return NextResponse.json(\n      { success: false, error: 'Tipo inv치lido' },\n      { status: 400 }\n    );\n\n  } catch (error) {\n    console.error('Erro ao atualizar item:', error);\n    return NextResponse.json(\n      { success: false, error: 'Erro ao atualizar item' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function DELETE(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const type = searchParams.get('type');\n    const id = searchParams.get('id');\n\n    if (!type || !id) {\n      return NextResponse.json(\n        { success: false, error: 'Par칙metros inv치lidos' },\n        { status: 400 }\n      );\n    }\n\n    if (type === 'group') {\n      // Deletar grupo e suas categorias\n      await pool.query('DELETE FROM categories WHERE group_id = $1', [id]);\n      await pool.query('DELETE FROM groups WHERE id = $1', [id]);\n    } else if (type === 'category') {\n      // Deletar categoria\n      await pool.query('DELETE FROM categories WHERE id = $1', [id]);\n    }\n\n    return NextResponse.json({ success: true });\n\n  } catch (error) {\n    console.error('Erro ao deletar item:', error);\n    return NextResponse.json(\n      { success: false, error: 'Erro ao deletar item' },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":"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","debugId":null}}]
}