{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/test-connection/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { Pool } from 'pg';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { connectionString } = await request.json();\n    \n    if (!connectionString) {\n      return NextResponse.json(\n        { success: false, error: 'URL de conexão é obrigatória' },\n        { status: 400 }\n      );\n    }\n\n    // Criar pool temporário para teste\n    const testPool = new Pool({\n      connectionString,\n      max: 1,\n      connectionTimeoutMillis: 5000,\n    });\n\n    try {\n      // Testar conexão\n      const client = await testPool.connect();\n      \n      // Buscar informações do banco\n      const result = await client.query(`\n        SELECT \n          current_database() as database,\n          current_user as user,\n          inet_server_addr() as host,\n          inet_server_port() as port,\n          version() as version\n      `);\n      \n      // Verificar se as tabelas principais existem\n      const tablesResult = await client.query(`\n        SELECT table_name \n        FROM information_schema.tables \n        WHERE table_schema = 'public' \n          AND table_name IN ('groups', 'categories', 'items', 'additionals')\n        ORDER BY table_name\n      `);\n      \n      // Verificar estrutura das tabelas (se são IDs inteiros)\n      const structureResult = await client.query(`\n        SELECT \n          table_name,\n          column_name,\n          data_type\n        FROM information_schema.columns\n        WHERE table_schema = 'public'\n          AND column_name = 'id'\n          AND table_name IN ('groups', 'categories', 'items', 'additionals')\n        ORDER BY table_name\n      `);\n      \n      client.release();\n      \n      const info = result.rows[0];\n      const tables = tablesResult.rows.map(r => r.table_name);\n      const structure = structureResult.rows;\n      \n      // Verificar se os IDs são inteiros\n      const hasIntegerIds = structure.every(s => \n        s.data_type === 'integer' || s.data_type === 'serial'\n      );\n      \n      return NextResponse.json({\n        success: true,\n        data: {\n          ...info,\n          tables,\n          hasIntegerIds,\n          structure,\n          message: hasIntegerIds \n            ? '✅ Banco com IDs inteiros detectado!' \n            : '⚠️ Banco usa UUIDs, precisa migração'\n        }\n      });\n      \n    } catch (error: any) {\n      console.error('Erro ao testar conexão:', error);\n      return NextResponse.json(\n        { \n          success: false, \n          error: error.message || 'Falha ao conectar com o banco'\n        },\n        { status: 500 }\n      );\n    } finally {\n      await testPool.end();\n    }\n    \n  } catch (error: any) {\n    console.error('Erro geral:', error);\n    return NextResponse.json(\n      { success: false, error: error.message },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,gBAAgB,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE/C,IAAI,CAAC,kBAAkB;YACrB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAA+B,GACxD;gBAAE,QAAQ;YAAI;QAElB;QAEA,mCAAmC;QACnC,MAAM,WAAW,IAAI,4GAAI,CAAC;YACxB;YACA,KAAK;YACL,yBAAyB;QAC3B;QAEA,IAAI;YACF,iBAAiB;YACjB,MAAM,SAAS,MAAM,SAAS,OAAO;YAErC,8BAA8B;YAC9B,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,CAAC;;;;;;;MAOnC,CAAC;YAED,6CAA6C;YAC7C,MAAM,eAAe,MAAM,OAAO,KAAK,CAAC,CAAC;;;;;;MAMzC,CAAC;YAED,wDAAwD;YACxD,MAAM,kBAAkB,MAAM,OAAO,KAAK,CAAC,CAAC;;;;;;;;;;MAU5C,CAAC;YAED,OAAO,OAAO;YAEd,MAAM,OAAO,OAAO,IAAI,CAAC,EAAE;YAC3B,MAAM,SAAS,aAAa,IAAI,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,UAAU;YACtD,MAAM,YAAY,gBAAgB,IAAI;YAEtC,mCAAmC;YACnC,MAAM,gBAAgB,UAAU,KAAK,CAAC,CAAA,IACpC,EAAE,SAAS,KAAK,aAAa,EAAE,SAAS,KAAK;YAG/C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,MAAM;oBACJ,GAAG,IAAI;oBACP;oBACA;oBACA;oBACA,SAAS,gBACL,wCACA;gBACN;YACF;QAEF,EAAE,OAAO,OAAY;YACnB,QAAQ,KAAK,CAAC,2BAA2B;YACzC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,OAAO,MAAM,OAAO,IAAI;YAC1B,GACA;gBAAE,QAAQ;YAAI;QAElB,SAAU;YACR,MAAM,SAAS,GAAG;QACpB;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,eAAe;QAC7B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GACvC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}