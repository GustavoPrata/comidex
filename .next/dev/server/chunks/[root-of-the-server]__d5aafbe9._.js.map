{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/templates/%5Btype%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.SUPABASE_SERVICE_ROLE_KEY!\n);\n\n// Default templates\nconst defaultTemplates: any = {\n  receipt: {\n    header: `{{company_name}}\n{{company_address}}\nTel: {{company_phone}}\n--------------------------------\n       CUPOM FISCAL\n--------------------------------\nData: {{date}}  Hora: {{time}}\nPedido: #{{order_number}}\nMesa: {{table_number}}\n--------------------------------`,\n    items: `QTD  DESCRIÇÃO         VALOR\n--------------------------------\n{{#each items}}\n{{quantity}}x   {{name}}\n                    R$ {{price}}\n{{/each}}`,\n    footer: `--------------------------------\nSubtotal:         R$ {{subtotal}}\nDesconto:         R$ {{discount}}\n--------------------------------\nTOTAL:            R$ {{total}}\n--------------------------------\nPagamento: {{payment_method}}\n--------------------------------\n    Obrigado pela preferência!\n        Volte sempre!\n--------------------------------`\n  },\n  kitchen: {\n    header: `================================\n       PEDIDO COZINHA\n================================\nMesa: {{table_number}}\nPedido: #{{order_number}}\nHora: {{time}}\n================================`,\n    items: `{{#each items}}\n{{quantity}}x {{name}}\n   {{#if observation}}\n   OBS: {{observation}}\n   {{/if}}\n--------------------------------\n{{/each}}`,\n    footer: `================================\nAtendente: {{customer_name}}\n================================`\n  },\n  bill: {\n    header: `{{company_name}}\n--------------------------------\n           CONTA\n--------------------------------\nMesa: {{table_number}}\nCliente: {{customer_name}}\nData: {{date}}  Hora: {{time}}\n--------------------------------`,\n    items: `ITEM                     VALOR\n--------------------------------\n{{#each items}}\n{{quantity}}x {{name}}\n                    R$ {{price}}\n{{/each}}`,\n    footer: `--------------------------------\nSUBTOTAL:         R$ {{subtotal}}\nTAXA SERVIÇO:     R$ {{service_fee}}\n--------------------------------\nTOTAL A PAGAR:    R$ {{total}}\n--------------------------------\n        Obrigado!`\n  },\n  order: {\n    header: `================================\n         PEDIDO MESA\n================================\nMesa: {{table_number}}\nAtendente: {{customer_name}}\nPedido: #{{order_number}}\n--------------------------------`,\n    items: `{{#each items}}\n[ ] {{quantity}}x {{name}}\n    {{#if observation}}\n    OBS: {{observation}}\n    {{/if}}\n{{/each}}`,\n    footer: `--------------------------------\nHora: {{time}}\n================================`\n  }\n};\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: { type: string } }\n) {\n  console.log('✅ Getting template for type:', params.type);\n\n  try {\n    // Para itens de pedido, usar template kitchen\n    let templateType = params.type;\n    if (templateType === 'order' || templateType === 'items') {\n      templateType = 'kitchen';\n    }\n\n    // Buscar template do banco\n    const { data, error } = await supabase\n      .from('print_templates')\n      .select('*')\n      .eq('template_type', templateType)\n      .single();\n\n    if (error && error.code !== 'PGRST116') { // PGRST116 = no rows returned\n      console.error('Error fetching template:', error);\n      // Se houver erro, retornar template padrão\n      return NextResponse.json({\n        template: defaultTemplates[templateType] || defaultTemplates.kitchen,\n        isDefault: true\n      });\n    }\n\n    // Se encontrou template customizado\n    if (data) {\n      const template = {\n        header: data.custom_header || defaultTemplates[templateType]?.header || '',\n        items: data.items_content || defaultTemplates[templateType]?.items || '',\n        footer: data.custom_footer || defaultTemplates[templateType]?.footer || ''\n      };\n      \n      return NextResponse.json({\n        template,\n        isDefault: false\n      });\n    }\n\n    // Se não encontrou, retornar template padrão\n    return NextResponse.json({\n      template: defaultTemplates[templateType] || defaultTemplates.kitchen,\n      isDefault: true\n    });\n\n  } catch (error) {\n    console.error('Error in template route:', error);\n    // Em caso de erro, retornar template padrão\n    return NextResponse.json({\n      template: defaultTemplates.kitchen,\n      isDefault: true\n    });\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,WAAW,IAAA,yMAAY,wPAE3B,QAAQ,GAAG,CAAC,yBAAyB;AAGvC,oBAAoB;AACpB,MAAM,mBAAwB;IAC5B,SAAS;QACP,QAAQ,CAAC;;;;;;;;;gCASmB,CAAC;QAC7B,OAAO,CAAC;;;;;SAKH,CAAC;QACN,QAAQ,CAAC;;;;;;;;;;gCAUmB,CAAC;IAC/B;IACA,SAAS;QACP,QAAQ,CAAC;;;;;;gCAMmB,CAAC;QAC7B,OAAO,CAAC;;;;;;SAMH,CAAC;QACN,QAAQ,CAAC;;gCAEmB,CAAC;IAC/B;IACA,MAAM;QACJ,QAAQ,CAAC;;;;;;;gCAOmB,CAAC;QAC7B,OAAO,CAAC;;;;;SAKH,CAAC;QACN,QAAQ,CAAC;;;;;;iBAMI,CAAC;IAChB;IACA,OAAO;QACL,QAAQ,CAAC;;;;;;gCAMmB,CAAC;QAC7B,OAAO,CAAC;;;;;SAKH,CAAC;QACN,QAAQ,CAAC;;gCAEmB,CAAC;IAC/B;AACF;AAEO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAAgC;IAExC,QAAQ,GAAG,CAAC,gCAAgC,OAAO,IAAI;IAEvD,IAAI;QACF,8CAA8C;QAC9C,IAAI,eAAe,OAAO,IAAI;QAC9B,IAAI,iBAAiB,WAAW,iBAAiB,SAAS;YACxD,eAAe;QACjB;QAEA,2BAA2B;QAC3B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,mBACL,MAAM,CAAC,KACP,EAAE,CAAC,iBAAiB,cACpB,MAAM;QAET,IAAI,SAAS,MAAM,IAAI,KAAK,YAAY;YACtC,QAAQ,KAAK,CAAC,4BAA4B;YAC1C,2CAA2C;YAC3C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,UAAU,gBAAgB,CAAC,aAAa,IAAI,iBAAiB,OAAO;gBACpE,WAAW;YACb;QACF;QAEA,oCAAoC;QACpC,IAAI,MAAM;YACR,MAAM,WAAW;gBACf,QAAQ,KAAK,aAAa,IAAI,gBAAgB,CAAC,aAAa,EAAE,UAAU;gBACxE,OAAO,KAAK,aAAa,IAAI,gBAAgB,CAAC,aAAa,EAAE,SAAS;gBACtE,QAAQ,KAAK,aAAa,IAAI,gBAAgB,CAAC,aAAa,EAAE,UAAU;YAC1E;YAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB;gBACA,WAAW;YACb;QACF;QAEA,6CAA6C;QAC7C,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,UAAU,gBAAgB,CAAC,aAAa,IAAI,iBAAiB,OAAO;YACpE,WAAW;QACb;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,4CAA4C;QAC5C,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,UAAU,iBAAiB,OAAO;YAClC,WAAW;QACb;IACF;AACF","debugId":null}}]
}